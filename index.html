?<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Secret Ingredient - What is Light?</title>
    <style>
* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #2d3748;
            line-height: 1.6;
        }

        /* Progress Bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }



        /* Main Container */
        .lesson-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Section Cards */
        section {
            background: transparent;
            margin-bottom: 30px;
            padding: 20px 0;
            display: none;
            opacity: 0;
            transition: all 0.6s ease;
            transform: translateY(20px);
        }

        section.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Typography */
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 1rem;
        }

        p {
            font-size: 1.125rem;
            line-height: 1.7;
            color: #4a5568;
            margin-bottom: 1.5rem;
        }

        ul {
            margin-left: 1.5rem;
            margin-bottom: 1.5rem;
        }

        li {
            font-size: 1.125rem;
            line-height: 1.7;
            color: #4a5568;
            margin-bottom: 0.5rem;
        }

        strong {
            color: #2d3748;
            font-weight: 600;
        }

        em {
            color: #667eea;
            font-style: normal;
            font-weight: 500;
        }

        /* Image Placeholders */
        .image-placeholder {
            margin: 2rem 0;
        }

        /* Confetti Animation */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            font-size: 20px;
            animation: confetti-fall 3s linear infinite;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti:nth-child(odd) {
            animation-duration: 2.5s;
            animation-delay: 0.2s;
        }

        .confetti:nth-child(even) {
            animation-duration: 3.5s;
            animation-delay: 0.5s;
        }

        .confetti:nth-child(3n) {
            animation-duration: 2.8s;
            animation-delay: 0.8s;
        }

        .confetti:nth-child(4n) {
            animation-duration: 3.2s;
            animation-delay: 0.3s;
        }

        .confetti:nth-child(5n) {
            animation-duration: 2.7s;
            animation-delay: 0.7s;
        }

        /* Success Message Animation */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
            z-index: 10000;
            opacity: 0;
            animation: success-popup 2.5s ease-out;
            pointer-events: none;
        }

        @keyframes success-popup {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            40% {
                transform: translate(-50%, -50%) scale(1);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
        }

        .image-placeholder img {
            width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        /* Specific sizing for individual images by section */
        #section1 .image-placeholder img {
            width: 70% !important;              /* Image 1: 70% (dramatic light beam) */
            max-width: 500px !important;
        }

        #section6 .image-placeholder img {
            width: 55% !important;              /* Image 2: 50-60% (meme image) */
            max-width: 400px !important;
        }
        
        #section9 .image-placeholder img {
            width: 85% !important;              /* Image 3: 80-90% (prism diagram) */
            max-width: 600px !important;
        }
        
        #section13 .image-placeholder img {
            width: 85% !important;              /* Image 4: 80-90% (red object) */
            max-width: 600px !important;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            #section1 .image-placeholder img {
                width: 80% !important;
                max-width: 400px !important;
            }

            #section6 .image-placeholder img {
                width: 65% !important;
                max-width: 350px !important;
            }
            
            #section9 .image-placeholder img,
            #section13 .image-placeholder img {
                width: 90% !important;
                max-width: 450px !important;
            }
        }
        
        @media (max-width: 480px) {
            #section1 .image-placeholder img {
                width: 85% !important;
                max-width: 300px !important;
            }

            #section6 .image-placeholder img {
                width: 75% !important;
                max-width: 280px !important;
            }
            
            #section9 .image-placeholder img,
            #section13 .image-placeholder img {
                width: 95% !important;
                max-width: 320px !important;
            }
        }

        /* Content Boxes */
        .vocab-section, .why-it-matters, .test-your-knowledge, .faq-section, 
        .stop-and-think, .check-your-knowledge {
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 8px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .vocab-section::before, .why-it-matters::before, .test-your-knowledge::before,
        .faq-section::before, .stop-and-think::before, .check-your-knowledge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.05;
            z-index: 0;
        }

        .vocab-section {
            background: linear-gradient(135deg, #e6f3ff 0%, #f0f8ff 100%);
            border-left-color: #4facfe;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.1);
        }

        .vocab-section::before {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
        }

        .why-it-matters {
            background: linear-gradient(135deg, #ffeef7 0%, #fff0f8 100%);
            border-left-color: #f093fb;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.1);
        }

        .why-it-matters::before {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }

        .test-your-knowledge, .check-your-knowledge {
            background: linear-gradient(135deg, #eafaf1 0%, #f0fcf4 100%);
            border-left-color: #68d391;
            box-shadow: 0 10px 30px rgba(104, 211, 145, 0.1);
        }

        .test-your-knowledge::before, .check-your-knowledge::before {
            background: linear-gradient(45deg, #68d391, #4fd1c7);
        }

        .faq-section {
            background: linear-gradient(135deg, #fffbeb 0%, #fefcf3 100%);
            border-left-color: #fbbf24;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.1);
        }

        .faq-section::before {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
        }

        .stop-and-think {
            background: linear-gradient(135deg, #f3e8ff 0%, #f8f4ff 100%);
            border-left-color: #a78bfa;
            box-shadow: 0 10px 30px rgba(167, 139, 250, 0.1);
        }

        .stop-and-think::before {
            background: linear-gradient(45deg, #a78bfa, #8b5cf6);
        }

        .vocab-section:hover, .why-it-matters:hover, .test-your-knowledge:hover,
        .faq-section:hover, .stop-and-think:hover, .check-your-knowledge:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .vocab-section h3 {
            color: #0ea5e9;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .why-it-matters h3 {
            color: #ec4899;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .test-your-knowledge h3, .check-your-knowledge h3 {
            color: #10b981;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .faq-section h3 {
            color: #d97706;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .stop-and-think h3 {
            color: #8b5cf6;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .vocab-section h4, .test-your-knowledge h4, .check-your-knowledge h4, .faq-section h4 {
            color: #2d3748;
            font-size: 1.25rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem 0;
            position: relative;
            z-index: 1;
        }

        .vocab-term {
            color: #0ea5e9;
            font-weight: 600;
        }

        /* Buttons */
        .continue-button, .reveal-button, .check-button {
            display: inline-block;
            padding: 16px 32px;
            margin-top: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50px;
            text-decoration: none;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .continue-button::before, .reveal-button::before, .check-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .continue-button:hover, .reveal-button:hover, .check-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .continue-button:hover::before, .reveal-button:hover::before, .check-button:hover::before {
            left: 100%;
        }

        .continue-button:active, .reveal-button:active, .check-button:active {
            transform: translateY(-1px);
        }

        /* Hidden state for conditional buttons */
        .continue-button[style*="display: none"] {
            display: none !important;
        }

        /* Ensure all conditional continue buttons match normal button styling exactly when shown */
        #continue-after-interactive:not([style*="display: none"]),
        #continue-after-check-knowledge:not([style*="display: none"]),
        #continue-after-test-knowledge:not([style*="display: none"]) {
            display: inline-block !important;
            width: auto !important;
            max-width: none !important;
            min-width: auto !important;
            padding: 16px 32px !important;
            margin: 30px auto !important;
            box-sizing: border-box !important;
        }

        /* Center ALL continue buttons by making all sections center them */
        section {
            text-align: center;
        }

        /* Reset text alignment for all content except continue buttons */
        section > *:not(.continue-button) {
            text-align: left;
        }

        /* Ensure content boxes also have left alignment */
        .check-your-knowledge,
        .test-your-knowledge,
        .vocab-section,
        .why-it-matters,
        .faq-section,
        .stop-and-think {
            text-align: left;
        }

        /* Smooth appearance for conditional continue buttons */
        .continue-button.show-with-animation {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Multiple Choice */
        .multiple-choice {
            margin: 1.5rem 0;
        }

        .choice-option {
            display: block;
            margin: 1rem 0;
            padding: 1.5rem;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .choice-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }

        .choice-option:hover {
            transform: translateX(5px);
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
        }

        .choice-option:hover::before {
            opacity: 0.05;
        }

        .choice-option.selected, .choice-option.correct {
            background: linear-gradient(135deg, #eafaf1 0%, #f0fcf4 100%);
            border-color: #68d391;
            color: #2d3748;
        }

        .choice-option.incorrect {
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
            border-color: #f87171;
            color: #2d3748;
        }

        .choice-explanation {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: #f1f5f9;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.6;
            animation: fadeIn 0.5s ease;
            position: relative;
            z-index: 1;
        }

        /* Spectrum Explorer - keeping the interactive styles but updating colors */
        .spectrum-explorer {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 2rem 0;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            padding: 40px;
        }

        .stage {
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .stage-text h3 {
            font-size: 1.75rem;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 16px 0;
        }

        .instruction {
            font-size: 1.1rem;
            color: #6b7280;
            margin: 0;
            padding: 16px 24px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            border: 2px dashed rgba(102, 126, 234, 0.3);
        }

        .continue-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .revelation-text h3 {
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 16px 0;
        }

        .spectrum-point {
            border-radius: 16px;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
            background: #ffffff;
        }

        .spectrum-point:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .spectrum-point.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .info-panel {
            background: #ffffff;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 24px;
        }

        .region-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hook {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .lesson-container {
                padding: 20px 15px;
            }

            section {
                padding: 15px 0;
                margin-bottom: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.75rem;
            }

            p, li {
                font-size: 1rem;
            }



            .continue-button, .reveal-button, .check-button {
                width: 100%;
            text-align: center;
                margin-top: 1.5rem;
            }

            .spectrum-explorer {
                padding: 20px;
            }

            .choice-option {
                padding: 1rem;
            }

            .mark-completed-button {
                padding: 14px 28px;
                font-size: 0.9rem;
                margin: 30px auto 15px auto;
            }
        }

        @media (max-width: 480px) {
            .lesson-container {
                padding: 15px 10px;
            }

            section {
                padding: 10px 0;
            }

            h1 {
                font-size: 1.75rem;
            }

            .vocab-section, .why-it-matters, .test-your-knowledge, 
            .faq-section, .stop-and-think, .check-your-knowledge {
                padding: 1.5rem;
            }

            .mark-completed-button {
                padding: 12px 24px;
                font-size: 0.85rem;
                margin: 25px auto 10px auto;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Accessibility */
        .choice-option:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        .continue-button:focus, .reveal-button:focus, .check-button:focus {
            outline: 2px solid white;
            outline-offset: 2px;
        }

        /* Content positioning */
        .vocab-section *, .why-it-matters *, .test-your-knowledge *, 
        .faq-section *, .stop-and-think *, .check-your-knowledge * {
            position: relative;
            z-index: 1;
        }

        /* Mark as Completed Button */
        .mark-completed-button {
            display: none;
            width: 100%;
            max-width: 400px;
            margin: 40px auto 20px auto;
            padding: 16px 32px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(72, 187, 120, 0.3);
            text-align: center;
            text-decoration: none;
        }

        .mark-completed-button.show {
            display: block;
        }

        .mark-completed-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(72, 187, 120, 0.4);
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        .mark-completed-button:active {
            transform: translateY(0);
        }

        .mark-completed-button.completed {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            box-shadow: 0 4px 20px rgba(148, 163, 184, 0.3);
            cursor: default;
        }

        .mark-completed-button.completed:hover {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            box-shadow: 0 4px 20px rgba(148, 163, 184, 0.3);
            transform: none;
        }

        /* Success Message */
        .lesson-success-message {
            text-align: center;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            margin: 20px auto;
            max-width: 300px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .lesson-success-message.show {
            opacity: 1;
            transform: translateY(0);
        }



        /* Spectrum Explorer specific modern styles */
        .spectrum-explorer {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .prism-svg {
            cursor: pointer;
            user-select: none;
            margin-bottom: 24px;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.1));
            border-radius: 12px;
        }

        .visible-indicator {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid #667eea;
            color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        .scale-label.visible {
            color: #667eea;
            font-weight: 600;
        }

        .exploration-progress {
            text-align: center;
            margin-top: 20px;
            padding: 16px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .progress-text {
            font-size: 0.875rem;
            color: #667eea;
            font-weight: 600;
        }



        /* Keep all other spectrum explorer functionality styles */
        .spectrum-bar {
            position: relative;
            width: 100%;
            height: 60px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        #spectrum-canvas {
            width: 100%;
            height: 100%;
            border-radius: 12px;
        }

        .spectrum-points {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0 0 24px 0;
            gap: 8px;
        }

        .spectrum-point {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px 8px;
            cursor: pointer;
            min-width: 80px;
            outline: none;
        }

        .point-icon {
            font-size: 1.5rem;
        }
        
        .point-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
        }

        .energy-scale {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .energy-label {
            font-size: 0.875rem;
            color: #6b7280;
            white-space: nowrap;
            font-weight: 500;
        }

        .energy-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .panel-header .region-icon {
            color: initial !important;
            background: none !important;
            -webkit-text-fill-color: initial !important;
            background-clip: initial !important;
        }
        
        /* Fix emoji colors in revelation text and all spectrum content */
        .revelation-text h3,
        .revelation-text,
        .spectrum-point .point-icon,
        h3 {
            color: inherit;
        }
        
        /* Target emojis specifically to prevent color inheritance */
        .revelation-text h3::after,
        .revelation-text h3 *,
        .spectrum-point .point-icon,
        .point-icon {
            background: none !important;
            -webkit-background-clip: initial !important;
            -webkit-text-fill-color: initial !important;
            background-clip: initial !important;
            color: initial !important;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif !important;
        }
        
        /* Specific fix for Mind = Blown emoji */
        .revelation-text h3 {
            background: none !important;
            -webkit-background-clip: initial !important;
            -webkit-text-fill-color: initial !important;
            background-clip: initial !important;
        }
        
        /* Universal emoji fix */
        span[style*="color: initial"],
        .emoji-fix {
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", sans-serif !important;
            font-style: normal !important;
            font-variant: normal !important;
            text-rendering: auto !important;
            -webkit-font-smoothing: auto !important;
        }
        
        /* Additional emoji protection */
        .revelation-text span,
        .spectrum-point .point-icon {
            display: inline !important;
            text-decoration: none !important;
            font-weight: normal !important;
        }

        .region-icon {
            font-size: 2rem;
            color: initial;
            text-shadow: none;
            filter: none;
            display: inline-block;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        }

        .story-content {
            margin-bottom: 24px;
        }

        .description {
            font-size: 1rem;
            line-height: 1.6;
            margin: 0;
            color: #6b7280;
        }

        .tech-specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .spec-item {
            text-align: center;
            padding: 12px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .spec-label {
            display: block;
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: 0.05em;
        }

        .spec-value {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }

        .color-display {
            margin-top: 16px;
        }

        .color-swatch {
            height: 40px;
            border-radius: 12px;
            margin-bottom: 8px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .color-note {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0;
            font-style: italic;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Responsive design for spectrum explorer */
        @media (min-width: 768px) {
            .exploration-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 32px;
                align-items: start;
            }
            
            .spectrum-points {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .spectrum-point {
                min-width: 100px;
            }
        }

        @media (max-width: 480px) {
            .spectrum-explorer {
                padding: 20px;
            }
            
            .spectrum-points {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }
            
            .spectrum-point {
                min-width: auto;
            }
            
            .point-label {
                font-size: 0.7rem;
            }
            
            .tech-specs {
                grid-template-columns: 1fr;
            }
        }
</style>
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    


    <div class="lesson-container">
        <section id="section1" class="visible">
            
            <div class="image-placeholder">
                <img src="images/l21_1.png" alt="...">
        </div>
            <h1>The Secret Ingredient: What is Light?</h1>
            <p>What do you and a camera have in common? You both need one crucial ingredient to see anything at all: light. But what <em>is</em> light, really? Is it a wave? A particle? A color? In this lesson, we'll pull back the curtain on the fundamental component of all vision, setting the stage for everything that follows.</p>
            <div class="continue-button" onclick="showNextSection(2)">Continue</div>
        </section>

        <section id="section2">
            <h2>The Rainbow of Reality</h2>
            <p>You might think of light as what comes from a lamp or the sun, but that's just a tiny slice of a much bigger reality. Light is a form of energy called an electromagnetic wave, and it exists across a vast range of types, from radio waves that carry your favorite music to X-rays that let doctors see your bones.</p>
            <div class="continue-button" onclick="showNextSection(3)">Continue</div>
        </section>

        <section id="section3">
            <p>This entire range is called the Electromagnetic Spectrum. The only difference between a radio wave and an X-ray is its wavelength?the distance from one peak of the wave to the next.</p>
            <div class="continue-button" onclick="showNextSection(4)">Continue</div>
        </section>

        <section id="section4">
            <p>Here's the cool part: the shorter the wavelength, the more energy the wave carries. That's why high-energy X-rays can be harmful with too much exposure, while low-energy radio waves pass through us all the time without any effect. Let's explore this spectrum.</p>
            <div class="spectrum-explorer" id="spectrum-explorer-001">
  <!-- Stage 1: Prism Discovery -->
  <div class="stage" id="stage-1">
    <div class="prism-container">
      <svg class="prism-svg" viewBox="0 0 400 200" width="400" height="200">
        <!-- Light beam -->
        <path id="light-beam" d="M 20 100 L 150 100" stroke="#ffffff" stroke-width="8" opacity="0.8"/>
        
        <!-- Prism -->
        <polygon id="prism" points="180,70 220,130 140,130" fill="rgba(255,255,255,0.3)" stroke="#ccc" stroke-width="2"/>
        
        <!-- Rainbow beams (hidden initially) -->
        <g id="rainbow-beams" style="opacity: 0;">
          <path d="M 180 100 L 350 80" stroke="#8B1A1A" stroke-width="3"/>
          <path d="M 180 100 L 350 88" stroke="#FF4500" stroke-width="3"/>
          <path d="M 180 100 L 350 96" stroke="#FFD700" stroke-width="3"/>
          <path d="M 180 100 L 350 104" stroke="#32CD32" stroke-width="3"/>
          <path d="M 180 100 L 350 112" stroke="#1E90FF" stroke-width="3"/>
          <path d="M 180 100 L 350 120" stroke="#4B0082" stroke-width="3"/>
        </g>
        
        <!-- Particle system container -->
        <g id="particles"></g>
      </svg>
      
      <div class="stage-text">
        <h3>What's hidden in white light?</h3>
        <p class="instruction" id="prism-instruction">Drag the light beam toward the prism</p>
        </div>
    </div>
  </div>

  <!-- Stage 2: Spectrum Reveal -->
  <div class="stage" id="stage-2" style="display: none;">
    <div class="spectrum-reveal-container">
      <div class="spectrum-bar-container">
        <div class="spectrum-bar" id="spectrum-bar">
          <canvas id="spectrum-canvas" width="800" height="60"></canvas>
          <div class="visible-indicator" id="visible-indicator">
            <div class="indicator-line"></div>
            <span class="indicator-text">Visible Light</span>
          </div>
        </div>
        
        <div class="scale-labels">
          <span class="scale-label">Radio</span>
          <span class="scale-label">Micro</span>
          <span class="scale-label">IR</span>
          <span class="scale-label visible">Visible</span>
          <span class="scale-label">UV</span>
          <span class="scale-label">X-ray</span>
          <span class="scale-label">Gamma</span>
        </div>
      </div>
      
      <div class="revelation-text" id="revelation-text">
        <h3 style="background: none !important; -webkit-background-clip: initial !important; -webkit-text-fill-color: initial !important; background-clip: initial !important; color: #667eea !important;">Mind = Blown! <span style="color: initial !important; background: none !important; -webkit-text-fill-color: initial !important;">&#129327;</span></h3>
        <p>The beautiful rainbow you just created is only <strong>0.0035%</strong> of all electromagnetic radiation!</p>
        <button class="continue-btn" id="continue-btn">Explore the Full Spectrum</button>
      </div>
    </div>
  </div>

  <!-- Stage 3: Exploration Mode -->
  <div class="stage" id="stage-3" style="display: none;">
    <div class="exploration-container">
      <div class="spectrum-navigation">
        <div class="spectrum-points">
          <div class="spectrum-point" data-region="radio" tabindex="0" role="button" aria-label="Explore radio waves">
            <span class="point-icon">&#128251;</span>
            <span class="point-label">Radio</span>
          </div>
          <div class="spectrum-point" data-region="microwave" tabindex="0" role="button" aria-label="Explore microwaves">
            <span class="point-icon">&#127858;</span>
            <span class="point-label">Micro</span>
          </div>
          <div class="spectrum-point" data-region="infrared" tabindex="0" role="button" aria-label="Explore infrared">
            <span class="point-icon">&#128293;</span>
            <span class="point-label">Infrared</span>
          </div>
          <div class="spectrum-point active" data-region="visible" tabindex="0" role="button" aria-label="Explore visible light">
            <span class="point-icon">&#128065;</span>
            <span class="point-label">Visible</span>
          </div>
          <div class="spectrum-point" data-region="ultraviolet" tabindex="0" role="button" aria-label="Explore ultraviolet">
            <span class="point-icon">&#9728;&#65039;</span>
            <span class="point-label">UV</span>
          </div>
          <div class="spectrum-point" data-region="xray" tabindex="0" role="button" aria-label="Explore X-rays">
            <span class="point-icon">&#127973;</span>
            <span class="point-label">X-ray</span>
          </div>
          <div class="spectrum-point" data-region="gamma" tabindex="0" role="button" aria-label="Explore gamma rays">
            <span class="point-icon">&#9889;</span>
            <span class="point-label">Gamma</span>
          </div>
        </div>
        
        <div class="energy-scale">
          <span class="energy-label">Low Energy</span>
          <div class="energy-bar">
            <div class="energy-fill" id="energy-fill" style="width: 57%;"></div>
          </div>
          <span class="energy-label">High Energy</span>
        </div>
      </div>

      <div class="info-panel" id="info-panel" role="region" aria-live="polite">
        <div class="panel-header">
          <h3 class="region-title" id="region-title">Visible Light</h3>
        </div>
        
        <div class="story-content" id="story-content">
          <p class="hook" id="region-hook">All humans can see</p>
          <p class="description" id="region-description">Only 0.0035% of all electromagnetic radiation - the tiny window of reality your eyes can detect</p>
        </div>
        
        <div class="tech-specs">
          <div class="spec-item">
            <span class="spec-label">Wavelength</span>
            <span class="spec-value" id="wavelength-value">380-700 nm</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">Energy Level</span>
            <span class="spec-value" id="energy-level">4/7</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">Application</span>
            <span class="spec-value" id="application">Human vision</span>
          </div>
        </div>
        
        <div class="color-display" id="color-display">
          <div class="color-swatch" id="color-swatch" style="background: linear-gradient(90deg, #6A1B9A 0%, #1976D2 14%, #388E3C 28%, #FBC02D 43%, #FF8F00 57%, #E64A19 71%, #C2185B 85%);">
          </div>
          <p class="color-note">The full range of colors humans can perceive</p>
        </div>
      </div>
    </div>
    
    <div class="exploration-progress">
      <span class="progress-text">Regions explored: <span id="progress-count">1</span>/7</span>
    </div>
  </div>

  <!-- Screen reader live region -->
  <div id="screen-reader-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <script>
    (function() {
      'use strict';
      
      // Spectrum data
      const spectrumData = {
        radio: {
          icon: '\\uD83D\\uDCFB',
          title: 'Radio Waves',
          hook: 'Invisible signals everywhere',
          description: 'Carry music, GPS, and WiFi through the air without you ever knowing',
          wavelength: '1m - 100km',
          energy: 1,
          application: 'AM/FM radio, WiFi',
          color: '#8E24AA'
        },
        microwave: {
          icon: '\\uD83C\\uDF72',
          title: 'Microwaves',
          hook: 'The same waves that heat lunch',
          description: 'Powerful enough to heat food by vibrating water molecules 2.45 billion times per second',
          wavelength: '1mm - 1m', 
          energy: 2,
          application: 'Ovens, cell phones',
          color: '#FF6F00'
        },
        infrared: {
          icon: '\\uD83D\\uDD25',
          title: 'Infrared',
          hook: 'Feel the heat',
          description: 'What you feel as warmth from the sun, a fire, or any heated object',
          wavelength: '700nm - 1mm',
          energy: 3, 
          application: 'Night vision, remote controls',
          color: '#D32F2F'
        },
        visible: {
          icon: '\\uD83D\\uDC41',
          title: 'Visible Light',
          hook: 'All humans can see',
          description: 'Only 0.0035% of all electromagnetic radiation - the tiny window of reality your eyes can detect',
          wavelength: '380-700 nm',
          energy: 4,
          application: 'Human vision',
          color: 'linear-gradient(90deg, #6A1B9A 0%, #1976D2 14%, #388E3C 28%, #FBC02D 43%, #FF8F00 57%, #E64A19 71%, #C2185B 85%)'
        },
        ultraviolet: {
          icon: '\\u2600\\uFE0F',
          title: 'Ultraviolet',
          hook: 'Invisible rays that both heal and harm',
          description: 'High energy radiation that creates vitamin D but can also damage skin and eyes',
          wavelength: '10-380 nm',
          energy: 5,
          application: 'Sunscreen protection, sterilization',
          color: '#512DA8'
        },
        xray: {
          icon: '\\uD83C\\uDFE5',
          title: 'X-rays',
          hook: 'Powerful enough to see through you',
          description: 'High energy radiation that passes through soft tissue but is blocked by bones and metal',
          wavelength: '0.01-10 nm',
          energy: 6,
          application: 'Medical imaging, security',
          color: '#303F9F'
        },
        gamma: {
          icon: '\\u26A1',
          title: 'Gamma Rays',
          hook: 'Ultimate energy',
          description: 'The most energetic light in the universe - millions of times more powerful than visible light',
          wavelength: '<0.01 nm',
          energy: 7,
          application: 'Cancer treatment, space research',
          color: '#1A237E'
        }
      };

      // State management
      let currentStage = 1;
      let exploredRegions = new Set(['visible']);
      let currentRegion = 'visible';

      // DOM elements
      const container = document.getElementById('spectrum-explorer-001');
      const stages = {
        1: container.querySelector('#stage-1'),
        2: container.querySelector('#stage-2'), 
        3: container.querySelector('#stage-3')
      };

      // Performance monitoring
      let performanceMode = 'enhanced';
      
      function detectPerformanceMode() {
        const memory = navigator.deviceMemory || 4;
        const connection = navigator.connection?.effectiveType || '4g';
        
        if (memory < 2 || connection === 'slow-2g') {
          performanceMode = 'basic';
        } else if (memory < 4) {
          performanceMode = 'standard';
        }
      }
      
      detectPerformanceMode();

      // Accessibility
      function announceToScreenReader(message) {
        const announcer = container.querySelector('#screen-reader-announcements');
        announcer.textContent = message;
      }

      // Stage 1: Prism Discovery
      function initPrismStage() {
        const lightBeam = container.querySelector('#light-beam');
        const prism = container.querySelector('#prism');
        const rainbowBeams = container.querySelector('#rainbow-beams');
        const instruction = container.querySelector('#prism-instruction');
        
        let isDragging = false;
        let hasTriggered = false;

        function getPointerPosition(event) {
          const svg = lightBeam.ownerSVGElement;
          const rect = svg.getBoundingClientRect();
          const clientX = event.clientX || (event.touches && event.touches[0].clientX);
          return {
            x: ((clientX - rect.left) / rect.width) * 400,
            y: 100
          };
        }

        function updateLightBeam(position) {
          lightBeam.setAttribute('d', `M 20 100 L ${Math.min(position.x, 150)} 100`);
          
          if (position.x > 140 && !hasTriggered) {
            hasTriggered = true;
            triggerLightSplit();
          }
        }

        function triggerLightSplit() {
          instruction.textContent = "Amazing! White light contains all colors!";
          lightBeam.style.opacity = '0.3';
          
          if (performanceMode !== 'basic') {
            animateRainbowBeams();
          } else {
            rainbowBeams.style.opacity = '1';
            setTimeout(transitionToStage2, 2000);
          }
        }

        function animateRainbowBeams() {
          rainbowBeams.style.transition = 'opacity 1s ease-out';
          rainbowBeams.style.opacity = '1';
          
          if (performanceMode === 'enhanced') {
            createParticles();
          }
          
          setTimeout(transitionToStage2, 2500);
        }

        function createParticles() {
          const particlesGroup = container.querySelector('#particles');
          const colors = ['#8B1A1A', '#FF4500', '#FFD700', '#32CD32', '#1E90FF', '#4B0082'];
          
          for (let i = 0; i < 20; i++) {
            setTimeout(() => {
              const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
              particle.setAttribute('cx', '180');
              particle.setAttribute('cy', '100');
              particle.setAttribute('r', '2');
              particle.setAttribute('fill', colors[Math.floor(Math.random() * colors.length)]);
              particle.style.opacity = '0.8';
              
              particlesGroup.appendChild(particle);
              
              // Animate particle
              const angle = (Math.random() - 0.5) * Math.PI / 3;
              const endX = 180 + Math.cos(angle) * 100;
              const endY = 100 + Math.sin(angle) * 30;
              
              particle.style.transition = 'all 1s ease-out';
              particle.style.transform = `translate(${endX - 180}px, ${endY - 100}px)`;
              particle.style.opacity = '0';
              
              setTimeout(() => {
                if (particlesGroup.contains(particle)) {
                  particlesGroup.removeChild(particle);
                }
              }, 1000);
            }, i * 50);
          }
        }

        // Event listeners
        function startDrag(event) {
          isDragging = true;
          lightBeam.classList.add('dragging');
          event.preventDefault();
        }

        function drag(event) {
          if (!isDragging) return;
          const position = getPointerPosition(event);
          updateLightBeam(position);
          event.preventDefault();
        }

        function endDrag() {
          isDragging = false;
          lightBeam.classList.remove('dragging');
        }

        // Mouse events
        lightBeam.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', endDrag);

        // Touch events
        lightBeam.addEventListener('touchstart', startDrag, { passive: false });
        document.addEventListener('touchmove', drag, { passive: false });
        document.addEventListener('touchend', endDrag);

        // Keyboard accessibility
        lightBeam.setAttribute('tabindex', '0');
        lightBeam.setAttribute('role', 'slider');
        lightBeam.setAttribute('aria-label', 'Drag light beam to prism');
        
        lightBeam.addEventListener('keydown', (event) => {
          if (event.key === 'ArrowRight' || event.key === ' ') {
            event.preventDefault();
            if (!hasTriggered) {
              triggerLightSplit();
              announceToScreenReader('Light beam hit the prism and split into rainbow colors!');
            }
          }
        });
      }

      // Stage 2: Spectrum Reveal
      function transitionToStage2() {
        currentStage = 2;
        stages[1].style.display = 'none';
        stages[2].style.display = 'flex';
        
        announceToScreenReader('Stage 2: Discovering the full electromagnetic spectrum');
        
        setTimeout(() => {
          renderSpectrumBar();
          animateSpectrumReveal();
        }, 100);
      }

      function renderSpectrumBar() {
        const canvas = container.querySelector('#spectrum-canvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas size
        canvas.width = 800;
        canvas.height = 60;
        
        // Clear canvas
        ctx.clearRect(0, 0, 800, 60);
        
        // Draw full spectrum
        const gradient = ctx.createLinearGradient(0, 0, 800, 0);
        gradient.addColorStop(0, '#8E24AA');    // Radio - purple
        gradient.addColorStop(0.15, '#FF6F00'); // Microwave - orange
        gradient.addColorStop(0.3, '#D32F2F');  // Infrared - red
        gradient.addColorStop(0.42, '#6A1B9A'); // Visible violet
        gradient.addColorStop(0.44, '#1976D2'); // Visible blue
        gradient.addColorStop(0.46, '#388E3C'); // Visible green
        gradient.addColorStop(0.48, '#FBC02D'); // Visible yellow
        gradient.addColorStop(0.5, '#FF8F00');  // Visible orange
        gradient.addColorStop(0.52, '#E64A19'); // Visible red
        gradient.addColorStop(0.58, '#512DA8'); // UV - purple
        gradient.addColorStop(0.75, '#303F9F'); // X-ray - indigo
        gradient.addColorStop(1, '#1A237E');    // Gamma - dark blue
        
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, 800, 60);
        
        // Add subtle border
        ctx.strokeStyle = 'rgba(102, 126, 234, 0.2)';
        ctx.lineWidth = 2;
        ctx.strokeRect(0, 0, 800, 60);
      }

      function animateSpectrumReveal() {
        const revelationText = container.querySelector('#revelation-text');
        const continueBtn = container.querySelector('#continue-btn');
        
        setTimeout(() => {
          revelationText.style.opacity = '1';
          revelationText.style.transform = 'translateY(0)';
        }, 500);
        
        continueBtn.addEventListener('click', transitionToStage3);
        continueBtn.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            transitionToStage3();
          }
        });
      }

      // Stage 3: Exploration Mode
      function transitionToStage3() {
        currentStage = 3;
        stages[2].style.display = 'none';
        stages[3].style.display = 'flex';
        
        announceToScreenReader('Stage 3: Explore each region of the electromagnetic spectrum');
        
        initExplorationMode();
      }

      function initExplorationMode() {
        const spectrumPoints = container.querySelectorAll('.spectrum-point');
        const infoPanel = container.querySelector('#info-panel');
        
        spectrumPoints.forEach(point => {
          point.addEventListener('click', () => selectRegion(point.dataset.region));
          point.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' || event.key === ' ') {
              event.preventDefault();
              selectRegion(point.dataset.region);
            }
          });
        });
        
        // Keyboard navigation
        container.addEventListener('keydown', (event) => {
          const regionKeys = ['1', '2', '3', '4', '5', '6', '7'];
          const regions = ['radio', 'microwave', 'infrared', 'visible', 'ultraviolet', 'xray', 'gamma'];
          
          const keyIndex = regionKeys.indexOf(event.key);
          if (keyIndex !== -1) {
            event.preventDefault();
            selectRegion(regions[keyIndex]);
          }
        });
        
        updateInfoPanel();
        updateProgress();
      }

      function selectRegion(region) {
        // Update active state
        const spectrumPoints = container.querySelectorAll('.spectrum-point');
        spectrumPoints.forEach(point => {
          point.classList.toggle('active', point.dataset.region === region);
        });
        
        currentRegion = region;
        exploredRegions.add(region);
        
        updateInfoPanel();
        updateProgress();
        updateEnergyBar();
        
        announceToScreenReader(`Now exploring ${spectrumData[region].title}. ${spectrumData[region].description}`);
      }

      function updateInfoPanel() {
        const data = spectrumData[currentRegion];
        
        container.querySelector('#region-title').textContent = data.title;
        container.querySelector('#region-hook').textContent = data.hook;
        container.querySelector('#region-description').textContent = data.description;
        container.querySelector('#wavelength-value').textContent = data.wavelength;
        container.querySelector('#energy-level').textContent = `${data.energy}/7`;
        container.querySelector('#application').textContent = data.application;
        
        // Update color display
        const colorDisplay = container.querySelector('#color-display');
        const colorSwatch = container.querySelector('#color-swatch');
        
        if (currentRegion === 'visible') {
          colorDisplay.style.display = 'block';
          colorSwatch.style.background = data.color;
        } else {
          colorDisplay.style.display = 'none';
        }
        
        // Add subtle animation
        if (performanceMode !== 'basic') {
          const infoPanel = container.querySelector('#info-panel');
          infoPanel.style.transform = 'scale(0.98)';
          setTimeout(() => {
            infoPanel.style.transform = 'scale(1)';
          }, 100);
        }
      }

      function updateProgress() {
        const progressCount = container.querySelector('#progress-count');
        progressCount.textContent = exploredRegions.size;
        
        if (exploredRegions.size === 7) {
          setTimeout(() => {
            announceToScreenReader('Congratulations! You have explored the entire electromagnetic spectrum!');

            // Show the continue button when all regions are explored
            const continueButton = document.getElementById('continue-after-interactive');
            if (continueButton) {
              continueButton.style.display = 'block';
              continueButton.classList.add('show-with-animation');
            }
          }, 500);
        }
      }

      function updateEnergyBar() {
        const energyFill = container.querySelector('#energy-fill');
        const data = spectrumData[currentRegion];
        const percentage = (data.energy / 7) * 100;
        
        if (performanceMode !== 'basic') {
          energyFill.style.width = `${percentage}%`;
        } else {
          energyFill.style.transition = 'none';
          energyFill.style.width = `${percentage}%`;
        }
      }

      // Initialize the interactive
      function init() {
        // Add initial styles for animations
        const revelationText = container.querySelector('#revelation-text');
        revelationText.style.opacity = '0';
        revelationText.style.transform = 'translateY(20px)';
        revelationText.style.transition = 'all 0.5s ease';
        
        // Set up accessibility attributes
        container.setAttribute('role', 'application');
        container.setAttribute('aria-label', 'Interactive Electromagnetic Spectrum Explorer');
        
        // Initialize first stage
        initPrismStage();
        
        // Track completion (simple analytics)
        window.setTimeout(() => {
          if (typeof window.parent !== 'undefined' && window.parent.trackLearningEvent) {
            window.parent.trackLearningEvent('spectrum_explorer_loaded');
          }
        }, 1000);
      }

      // Start the interactive
      init();
    })();
  </script>
</div>

            <div class="continue-button" id="continue-after-interactive" onclick="showNextSection(5)" style="display: none;">Continue</div>
        </section>

        <section id="section5">
            <div class="check-your-knowledge">
                <h3>Check Your Knowledge</h3>
                <h4>According to the Spectrum Explorer, which of these carries more energy?</h4>
                <div class="multiple-choice">
                    <div class="choice-option" onclick="selectChoice(this, false, 'A microwave.', 'Not quite! Microwaves have a longer wavelength than UV light, which means they carry less energy. Think about why you\'re told to wear sunscreen (to block UV) but you can stand next to a microwave oven.')">
                        A microwave.
                    </div>
                    <div class="choice-option" onclick="selectChoice(this, true, 'An ultraviolet (UV) wave.', 'Exactly! UV waves have a much shorter wavelength, packing more energy. This is why they can cause sunburn.')">
                        An ultraviolet (UV) wave.
                    </div>
                </div>
            </div>
            <div class="continue-button" id="continue-after-check-knowledge" onclick="showNextSection(6)" style="display: none;">Continue</div>
        </section>

        <section id="section6">
            <p>The part of the spectrum our eyes can detect, called the Visible Spectrum, is incredibly narrow, typically ranging from about 400 nanometers (violet) to 700 nanometers (red). Every color you've ever seen fits into this tiny window!</p>
            <div class="image-placeholder">
                <img src="images/l21_2.png" alt="A meme format. Top panel shows a picture of the vast electromagnetic spectrum. Bottom panel shows a character squinting at a tiny, highlighted sliver labeled 'What I can actually see'. The character says, 'Well, that feels... limited.'">
            </div>
            <div class="continue-button" onclick="showNextSection(7)">Continue</div>
        </section>

        <section id="section7">
            <h2>A Particle or a Wave?</h2>
            <p>So, light is a wave. Simple enough, right? Well, physics has a fun twist for us. Depending on how you look at it, light also behaves like a stream of tiny energy packets called photons.</p>
            <div class="continue-button" onclick="showNextSection(8)">Continue</div>
        </section>

        <section id="section8">
            <p>This idea is called Wave-Particle Duality. It sounds strange, but both models are super useful.</p>
            <div class="continue-button" onclick="showNextSection(9)">Continue</div>
        </section>

        <section id="section9">
            <p>The <strong>wave model</strong> is perfect for explaining things like color. When white light passes through a prism, its different wavelengths bend at slightly different angles, splitting it into a rainbow. That's a wave phenomenon!</p>
            <div class="image-placeholder">
                <img src="images/l21_4.png" alt="A beautiful, clear diagram showing white light entering a prism and dispersing into the colors of the rainbow, with labels for red, green, and blue light bending at different angles.">
            </div>
            <div class="continue-button" onclick="showNextSection(10)">Continue</div>
        </section>

        <section id="section10">
            <p>But the <strong>particle model</strong> is essential for understanding how a camera sensor (or your eye!) actually <em>detects</em> light. A single <strong>photon</strong> can hit a sensor and trigger a tiny electrical signal. It's like a tiny billiard ball hitting a target. We'll dive deep into this when we get to digital cameras.</p>
            <div class="continue-button" onclick="showNextSection(11)">Continue</div>
        </section>

        <section id="section11">
            <div class="why-it-matters">
                <h3>Why It Matters</h3>
                <p>Understanding that color is just a specific wavelength of light is fundamental. In computer vision, we're teaching machines to interpret data that corresponds to these wavelengths, just like our brains do. And the concept of a photon is key to how a digital sensor turns light into a digital signal.</p>
            </div>
            <div class="continue-button" onclick="showNextSection(12)">Continue</div>
        </section>

        <section id="section12">
            <h2>The Color of Things</h2>
            <p>So if light contains all these colors, why does a banana look yellow and a strawberry look red? It's not because they create their own light. It's all about what they absorb and what they reflect.</p>
            <div class="continue-button" onclick="showNextSection(13)">Continue</div>
        </section>

        <section id="section13">
            <p>Imagine white light from the sun, which contains all visible wavelengths, hitting a strawberry. The surface of the strawberry has properties that cause it to absorb most of the blue and green wavelengths, but it reflects the red wavelengths back out. When that reflected red light enters your eye, your brain says, 'That's a red strawberry!'</p>
            <div class="image-placeholder">
                <img src="images/l21_3.png" alt="A simple, clean diagram. On the left, a flashlight labeled 'White Light (All Colors)' shines a beam containing red, green, and blue rays. The beam hits a red block. The blue and green rays are shown being absorbed (fading into the block), while the red ray bounces off and enters a stylized drawing of an eye on the right.">
            </div>
            <div class="continue-button" onclick="showNextSection(14)">Continue</div>
        </section>

        <section id="section14">
            <div class="vocab-section">
                <h3>Build Your Vocab</h3>
                <h4 class="vocab-term">Electromagnetic Spectrum</h4>
                <p>The entire range of light radiation, from high-energy gamma rays to low-energy radio waves. We can only see a tiny fraction of it.</p>
                <h4 class="vocab-term">Wavelength</h4>
                <p>The distance between the peaks of a wave. In visible light, wavelength determines the color we perceive.</p>
                <h4 class="vocab-term">Photon</h4>
                <p>A single, discrete particle of light. This concept is key to understanding how sensors convert light to electricity.</p>
            </div>
            <div class="continue-button" onclick="showNextSection(15)">Continue</div>
        </section>

        <section id="section15">
            <div class="faq-section">
                <h3>Frequently Asked Questions</h3>
                <h4>What makes an object white or black, then?</h4>
                <p>Great question! It follows the same principle. A 'white' object, like a piece of paper, reflects almost all visible wavelengths that hit it. A 'black' object, like charcoal, absorbs almost all visible wavelengths, reflecting very little light back to your eye.</p>
            </div>
            <div class="continue-button" onclick="showNextSection(16)">Continue</div>
        </section>

        <section id="section16">
            <div class="test-your-knowledge">
                <h3>Test Your Knowledge</h3>
                <h4>You're wearing a green shirt. Why does it appear green under a white light?</h4>
                <div class="multiple-choice">
                    <div class="choice-option" onclick="selectChoice(this, false, 'It absorbs green light and reflects all other colors.', 'Almost the opposite! If it reflected all other colors, it would look magenta (a mix of red and blue).')">
                        It absorbs green light and reflects all other colors.
                    </div>
                    <div class="choice-option" onclick="selectChoice(this, true, 'It reflects green light and absorbs other colors.', 'Exactly! The material is tuned to bounce green wavelengths back to your eyes while soaking up the reds and blues.')">
                        It reflects green light and absorbs other colors.
                    </div>
                    <div class="choice-option" onclick="selectChoice(this, false, 'It creates its own green light.', 'Objects don\'t typically create their own light unless they are a light source, like a screen or a firefly. Most objects just reflect ambient light.')">
                        It creates its own green light.
                    </div>
                    <div class="choice-option" onclick="selectChoice(this, false, 'It changes the white light into green light.', 'While some materials can shift wavelengths (fluorescence), that\'s a special case. For most everyday objects, color comes from simple reflection and absorption.')">
                        It changes the white light into green light.
                    </div>
                </div>
            </div>
            <div class="continue-button" id="continue-after-test-knowledge" onclick="showNextSection(17)" style="display: none;">Continue</div>
        </section>

        <section id="section17">
            <h2>Review and Reflect</h2>
            
            <p>Fantastic work! We've demystified the very essence of vision: light. Here's what we uncovered:</p>
            <ul>
                <li><strong>Light is an Electromagnetic Wave</strong>, and the visible colors we see are just a tiny part of a vast spectrum.</li>
                <li><strong>Wavelength is key:</strong> It determines both the color and the energy of light.</li>
                <li><strong>Wave-Particle Duality:</strong> Light acts as a wave (explaining color) and a particle (a <strong>photon</strong>, explaining how sensors work).</li>
                <li><strong>Object Color:</strong> An object's color is determined by which wavelengths of light it <strong>reflects</strong> and which it <strong>absorbs</strong>.</li>
            </ul>
            <p>In the next lesson, we'll see how nature's own masterpiece, the human eye, is perfectly designed to capture and process this light.</p>
        </section>

        <!-- Mark as Completed Button -->
        <button id="markCompletedBtn" class="mark-completed-button" onclick="toggleCompleted()"> &#10003; Mark as Completed
        </button>
        

    </div>

    <script>
        let currentSection = 1;
        const totalSections = 17;

        // Initialize
        updateProgress();
        
        // Show the mark as completed button if already on the final section
        if (currentSection === totalSections) {
            const completedButton = document.getElementById('markCompletedBtn');
            if (completedButton) {
                completedButton.classList.add('show');
            }
        }

        function showNextSection(nextSectionId) {
            const currentSectionElement = document.getElementById(`section${currentSection}`);
            const nextSectionElement = document.getElementById(`section${nextSectionId}`);
            const currentButton = event.target;
            
            if (!nextSectionElement) return;
            
            // Hide the continue button
            currentButton.style.display = 'none';
            
            // Show next section with smooth animation
            nextSectionElement.classList.add('visible', 'animate-in');
            
            // Update current section
            currentSection = nextSectionId;
            updateProgress();
            
            // Show the mark as completed button when reaching the final section
            if (currentSection === totalSections) {
                const completedButton = document.getElementById('markCompletedBtn');
                if (completedButton) {
                    completedButton.classList.add('show');
                }
            }
            
            // Smooth scroll to new section
            setTimeout(() => {
                nextSectionElement.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start'
                });
            }, 300);
        }

        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            const progress = (currentSection / totalSections) * 100;
            progressBar.style.width = `${progress}%`;
        }



        function revealAnswer(id) {
            const revealText = document.getElementById(id);
            const revealButton = event.target;
            
            if (revealText && revealButton) {
                revealText.style.display = "block";
                revealText.classList.add('animate-in');
                revealButton.style.display = "none";
            }
        }

        function selectChoice(element, isCorrect, optionText, explanation) {
            // Remove previous selections
            const choices = element.parentNode.querySelectorAll('.choice-option');
            choices.forEach(choice => {
                choice.classList.remove('selected', 'correct', 'incorrect');
                const existingExplanation = choice.querySelector('.choice-explanation');
                if (existingExplanation) {
                    existingExplanation.remove();
                }
            });

            // Mark the selected choice
            element.classList.add('selected');
            element.classList.add(isCorrect ? 'correct' : 'incorrect');

            // Add explanation with animation
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'choice-explanation animate-in';
            explanationDiv.style.display = 'block';
            explanationDiv.innerHTML = `<strong>${isCorrect ? 'Correct!' : 'Not quite.'}</strong> ${explanation}`;
            element.appendChild(explanationDiv);

            // Show correct answer if wrong choice was selected
            if (!isCorrect) {
                choices.forEach(choice => {
                    if (choice !== element) {
                        const choiceText = choice.textContent.trim();
                        // Look for the correct answer based on the content
                        if (choiceText.includes('ultraviolet (UV)') || choiceText.includes('reflects green light')) {
                            choice.classList.add('correct');
                            const correctExplanation = document.createElement('div');
                            correctExplanation.className = 'choice-explanation animate-in';
                            correctExplanation.style.display = 'block';
                            if (choiceText.includes('ultraviolet (UV)')) {
                                correctExplanation.innerHTML = '<strong>This is the correct answer:</strong> Exactly! UV waves have a much shorter wavelength, packing more energy. This is why they can cause sunburn.';
                            } else if (choiceText.includes('reflects green light')) {
                                correctExplanation.innerHTML = '<strong>This is the correct answer:</strong> Exactly! The material is tuned to bounce green wavelengths back to your eyes while soaking up the reds and blues.';
                            }
                            choice.appendChild(correctExplanation);
                        }
                    }
                });
            }

            // Show continue button after answering
            // Determine which section this question is in and show the appropriate continue button
            const parentSection = element.closest('section');
            if (parentSection) {
                const sectionId = parentSection.id;
                let continueButtonId = null;
                
                if (sectionId === 'section5') {
                    // Check Your Knowledge section
                    continueButtonId = 'continue-after-check-knowledge';
                } else if (sectionId === 'section16') {
                    // Test Your Knowledge section
                    continueButtonId = 'continue-after-test-knowledge';
                }
                
                if (continueButtonId) {
                    const continueButton = document.getElementById(continueButtonId);
                    if (continueButton && continueButton.style.display === 'none') {
                        setTimeout(() => {
                            continueButton.style.display = 'block';
                            continueButton.classList.add('show-with-animation');
                        }, 1000); // Small delay to let explanation show first
                    }
                }
            }
        }

        // Keyboard Support
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowRight' || event.key === ' ') {
                const continueButton = document.querySelector(`#section${currentSection} .continue-button`);
                if (continueButton && continueButton.style.display !== 'none') {
                    event.preventDefault();
                    continueButton.click();
                }
            }
        });

        // Smooth scrolling
        document.documentElement.style.scrollBehavior = 'smooth';



        // Mark as Completed functionality integrated with ProgressTracker
        function toggleCompleted() {
            const button = document.getElementById('markCompletedBtn');
            if (!button) return;
            
            const isCompleted = button.classList.contains('completed');
            
            if (!isCompleted) {
                // Try to use platform's ProgressTracker system
                try {
                    if (window.parent && window.parent.ProgressTracker) {
                        // Use the exact IDs that match the viewed lesson
                        let courseId = 'computer-vision';
                        let pathId = 'perception-systems';
                        let moduleId = 'cv-nature-of-light';
                        let lessonId = 'cv-l1-secret-ingredient';
                        
                        // Try to get more specific IDs from the parent window's current route
                        if (window.parent.currentRoute) {
                            const route = window.parent.currentRoute;
                            if (route.courseId) courseId = route.courseId;
                            if (route.pathId) pathId = route.pathId;
                            if (route.moduleId) moduleId = route.moduleId;
                            if (route.lessonId) lessonId = route.lessonId;
                        }
                        
                        // Also check URL parameters as additional override
                        const urlParams = new URLSearchParams(window.location.search);
                        if (urlParams.get('course')) courseId = urlParams.get('course');
                        if (urlParams.get('path')) pathId = urlParams.get('path');
                        if (urlParams.get('module')) moduleId = urlParams.get('module');
                        if (urlParams.get('lesson')) lessonId = urlParams.get('lesson');
                        
                        window.parent.ProgressTracker.markLessonCompleted(courseId, pathId, moduleId, lessonId);
                    }
                } catch (error) {
                    console.error('Error with ProgressTracker:', error);
                }
                
                // Update button appearance
                button.classList.add('completed');
                button.innerHTML = '&#9989; Completed!';
                
                // Trigger celebration
                triggerCelebration();
                
                // Fallback localStorage for direct access
                localStorage.setItem('lesson_cv-ch02-l1_completed', 'true');
            }
        }

        function triggerCelebration() {
            // Create confetti
            createConfetti();
            
            // Show success message
            showSuccessMessage();
        }

        function createConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            document.body.appendChild(confettiContainer);

            const confettiEmojis = ['??', '??', '?', '??', '??', '??', '??', '??', '??', '??'];
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd', '#98d8c8', '#f7dc6f'];

            // Create 50 confetti pieces
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    
                    // Random emoji or colored shape
                    if (Math.random() > 0.6) {
                        confetti.textContent = confettiEmojis[Math.floor(Math.random() * confettiEmojis.length)];
                    } else {
                        confetti.innerHTML = '?';
                        confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                    }
                    
                    // Random horizontal position
                    confetti.style.left = Math.random() * 100 + '%';
                    
                    // Random animation delay
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    
                    confettiContainer.appendChild(confetti);
                }, i * 50); // Stagger the creation
            }

            // Remove confetti after animation
            setTimeout(() => {
                if (confettiContainer.parentNode) {
                    confettiContainer.parentNode.removeChild(confettiContainer);
                }
            }, 5000);
        }

        function showSuccessMessage() {
            const successMessage = document.createElement('div');
            successMessage.className = 'success-message';
            successMessage.innerHTML = '?? Lesson Completed! Great Job! ??';
            document.body.appendChild(successMessage);

            // Remove success message after animation
            setTimeout(() => {
                if (successMessage.parentNode) {
                    successMessage.parentNode.removeChild(successMessage);
                }
            }, 2500);
        }

        // Load completion status on page load
        window.addEventListener('load', function() {
            const button = document.getElementById('markCompletedBtn');
            if (!button) return;
            
            // Check platform ProgressTracker first
            if (window.parent && window.parent.ProgressTracker) {
                // Use the exact IDs that match the viewed lesson
                let courseId = 'computer-vision';
                let pathId = 'perception-systems';
                let moduleId = 'cv-nature-of-light';
                let lessonId = 'cv-l1-secret-ingredient';
                
                if (window.parent.currentRoute) {
                    const route = window.parent.currentRoute;
                    if (route.courseId) courseId = route.courseId;
                    if (route.pathId) pathId = route.pathId;
                    if (route.moduleId) moduleId = route.moduleId;
                    if (route.lessonId) lessonId = route.lessonId;
                }
                
                // Check URL parameters as override
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('course')) courseId = urlParams.get('course');
                if (urlParams.get('path')) pathId = urlParams.get('path');
                if (urlParams.get('module')) moduleId = urlParams.get('module');
                if (urlParams.get('lesson')) lessonId = urlParams.get('lesson');
                
                const progress = window.parent.ProgressTracker.getLessonProgress(courseId, pathId, moduleId, lessonId);
                
                if (progress.state === window.parent.ProgressTracker.STATES.COMPLETED) {
                    button.classList.add('completed');
                    button.innerHTML = '&#9989; Completed!';
                    return;
                }
            }
            
            // Fallback to localStorage
            const isCompleted = localStorage.getItem('lesson_cv-ch02-l1_completed') === 'true';
            if (isCompleted) {
                button.classList.add('completed');
                button.innerHTML = '&#9989; Completed!';
            }
        });
    </script>
</body>
</html>
